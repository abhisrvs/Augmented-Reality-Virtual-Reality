<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Human Anatomy - Organ Overlay</title>
    <meta name="description" content="AR Human Anatomy Web App - Organ Overlay">
    <script src="assets/js/aframe.min.js"></script>
    <style>
        body { margin: 0; font-family: sans-serif; overflow: hidden; }
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            color: white;
        }
        #ui button { padding: 10px; margin: 5px; cursor: pointer; }
        #message { margin-top: 10px; font-weight: bold; }
        a-scene { height: 100vh; width: 100vw; }
        #icons {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
        }
        #icons span {
            font-size: 24px; cursor: pointer; margin-left: 15px;
            color: white; background: rgba(0,0,0,0.5);
            padding: 5px 10px; border-radius: 5px;
        }
        video { display: none; } /* Keep video hidden, A-Frame uses it */

        /* New Sidebar Styles */
        #organSidebar {
            position: absolute;
            top: 80px; /* Adjust as needed */
            right: 10px;
            width: 160px; /* Adjust as needed */
            background: rgba(50, 50, 50, 0.75);
            padding: 10px;
            border-radius: 8px;
            color: white;
            z-index: 100;
            display: none; /* Initially hidden */
        }
        #organSidebar h3 { margin-top: 0; margin-bottom: 10px; text-align: center; font-size: 1em; }
        #organSidebar ul { list-style: none; padding: 0; margin: 0; }
        #organSidebar li {
            padding: 8px;
            margin-bottom: 8px;
            background: rgba(80, 80, 80, 0.85);
            border-radius: 5px;
            cursor: pointer; /* For future grabbing */
            text-align: center;
            font-size: 0.9em;
        }
        #organSidebar li:hover { background: rgba(100, 100, 100, 0.95); }
        #organSidebar li:last-child { margin-bottom: 0; }


        /* Success Message Dialog */
        #successDialog {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(30, 130, 76, 0.92); /* Greenish */
            color: white;
            padding: 20px 25px;
            border-radius: 10px;
            z-index: 200; /* Above everything */
            text-align: center;
            font-size: 1.1em;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            display: none; /* Initially hidden */
        }
        #successDialog button {
            padding: 8px 15px;
            margin-top: 15px;
            cursor: pointer;
            border: none;
            background-color: #f0f0f0;
            color: #333;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <div id="ui">
        <button id="startButton">Start</button>
        <button id="stopButton" style="display: none;">Stop</button>
        <div id="message">Load models & Press Start.</div>
    </div>
    <div id="icons">
        <span id="closeIcon" title="Close App (Simulated)">X</span>
    </div>

    <div id="organSidebar">
        <h3>Placeable Organs</h3>
        <ul>
            <li data-organ="lungs" data-model-asset="#lungsModelAsset" data-scale="1.2 1.2 1.2">Lungs</li>
            <li data-organ="liver" data-model-asset="#liverModelAsset" data-scale="0.9 0.9 0.9">Liver</li>
            <li data-organ="heart" data-model-asset="#heartModelAsset" data-scale="0.5 0.5 0.5">Heart</li>
            </ul>
    </div>

    <div id="successDialog">
        <p id="successMessageText">Organs successfully overlayed!</p>
        <button id="closeSuccessDialog">OK</button>
    </div>


    <a-scene id="arScene" vr-mode-ui="enabled: false" embedded>
        <a-assets>
            <video id="webcam" autoplay playsinline crossOrigin="anonymous"></video>
            <a-asset-item id="mainOrgansModel" src="models/organs.glb"></a-asset-item> 
            <a-asset-item id="lungsModelAsset" src="models/lungs.glb"></a-asset-item>
            <a-asset-item id="liverModelAsset" src="models/liver.glb"></a-asset-item>
            <a-asset-item id="heartModelAsset" src="models/heart.glb"></a-asset-item>
            
        </a-assets>

        <a-camera id="camera" position="0 1.6 0.5" look-controls="enabled: true" wasd-controls="enabled: false">
             <a-cursor raycaster="objects: .clickable, .grabbable" fuse="false" color="yellow"></a-cursor>
        </a-camera>

        <a-plane id="videoBackground"
            height="2.4" width="3.2" material="shader: flat; src: #webcam; transparent: true;"
            position="0 1.6 -1.63" scale="-1 1 1"> </a-plane>


        <a-light type="ambient" color="#CCC"></a-light>
        <a-light type="directional" position="-0.5 1 1" intensity="0.8"></a-light>
        <a-light type="directional" position="0.5 1 -1" intensity="0.5"></a-light>

        <a-entity id="bodyAnchor" visible="false">
            <a-gltf-model id="mainOrgansEntity"
                          src="#mainOrgansModel"
                          position="-0.474 0.671 0" scale="1.490 1.330 1.540" rotation="0 0 0"  class="organ">
            </a-gltf-model>
        </a-entity>

        <a-sphere id="leftHand" radius="0.03" color="#FF7F50" visible="false" material="opacity: 0.7;"></a-sphere> <a-sphere id="rightHand" radius="0.03" color="#6495ED" visible="false" material="opacity: 0.7;"></a-sphere> <a-entity id="spawnPoint" position="-0.6 1.3 -1.0"></a-entity> </a-scene>

    <script type="module" src="script.js"></script>
</body>
</html>